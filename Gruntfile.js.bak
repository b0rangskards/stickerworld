'use strict';

module.exports = function (grunt) {

    // Load grunt tasks automatically
    require('load-grunt-tasks')(grunt);

    // Time how long tasks take. Can help when optimizing build times
    require('time-grunt')(grunt);

    // Project configuration
    grunt.initConfig({
        // Metadata
        pkg: grunt.file.readJSON('package.json'),
        // Project settings
        laravel: {
            // Configurable paths
            assets: 'app/assets',
            bower: 'app/assets/components/bower',
            bucketadmin: 'app/assets/packages/bucketadmin_1.4',
            dest: 'public',
            views: 'app/views'
        },
        // Watches files for changes and runs tasks based on the changed files
        watch: {
            js: {
                files: ['<%= laravel.assets %>/scripts/{,*/}*.js'],
                tasks: ['jshint', 'concat', 'uglify']
            },
            images: {
                files: ['<%= laravel.assets %>/images/*.{gif,jpeg,jpg,png,webp,svg}'],
                tasks: ['imagemin']
            },
            fonts: {
                files: ['<%= laravel.bower %>/fontawesome/fonts/*.*', '<%= laravel.bucketadmin %>/bucket-ico-fonts/*.*'],
                tasks: ['copy:fonts']
            },
            gruntfile: {
                files: ['Gruntfile.js'],
                tasks: ['jshint']
            },
            styles: {
                files: ['<%= laravel.assets %>/styles/{,*/}*.css'],
                tasks: ['cssmin']
            }
        },
        // Empties folders to start fresh
        clean: {
            files: {
                dot: true,
                src: [
                    '<%= laravel.dest %>/fonts/*',
                    '<%= laravel.dest %>/images/*.*',
                    '<%= laravel.dest %>/scripts/*',
                    '<%= laravel.dest %>styles/*'
                    //'!<%= laravel.dest %>/index.php',
                    //'!<%= laravel.dest %>/robots.txt',
                    //'!<%= laravel.dest %>/.htaccess'
                    //'!<%= laravel.dest %>/favicon.ico',
                ]
            }
        },
        concat: {
            options: {
                stripBanners: false
            },
            js: {
                src: [
                    '<%= laravel.bower %>/jquery/dist/jquery.min.js',
                    '<%= laravel.bower %>/bootstrap/dist/scripts/bootstrap.min.js'
                ],
                dest: '<%= laravel.dest %>/scripts/vendor.js'
            },
            css: {
                src: [
                    '<%= laravel.bower %>/bootstrap/dist/css/bootstrap.min.js',
                    '<%= laravel.bower %>/fontawesome/css/font-awesome.min.js'
                ],
                dest: '<%= laravel.dest %>/styles/vendor.css'
            }
        },
        uglify: {
            options: {
                mangle: false,
                compress: true,
                banner: '<%= pkg.name %> <%= grunt.template.today("yyyy-mm-dd") %> - vendorjs'
            },
            dist: {
                src: '<%= concat.js.dest %>',
                dest: '<%= laravel.dest %>/scripts/vendor.min.js'
            }
        },
        // Concatenate and minify CSS
        cssmin: {
            dist: {
                files: [{
                    '<%= laravel.dest %>/styles/vendor.min.css': [
                        '<%= laravel.dest %>/styles/vendor.css'
                    ]
                },
                    {
                        '<%= laravel.assets %>/styles/*.css': [
                            '<%= laravel.dest %>/styles/main.min.css'
                        ]
                    }]
            }
        },
        jshint: {
            options: {
                jshintrc: ".jshintrc"
            },
            gruntfile: {
                src: 'gruntfile.js'
            },
            target: {
                src: ['<%= laravel.assets %>/scripts/*.js']
            }
        },
        // The following *-min tasks produce minified files in the dist folder
        imagemin: {
            dist: {
                files: [{
                    expand: true,
                    cwd: '<%= laravel.assets %>/images',
                    src: '{,*/}*.{gif,jpeg,jpg,png}',
                    dest: '<%= laravel.dest %>/images'
                }]
            }
        },
        copy: {
            //images: {
            //    files: [{
            //        expand: true,
            //        cwd: '<%= laravel.assets %>',
            //        dest: '<%= laravel.dest %>/images',
            //        src: [
            //            'images/*.{ico,png,jpg,jpeg}'
            //        ]
            //    }]
            //},
            fonts: {
                files: [{
                    expand: true,
                    dot: true,
                    cwd: '<%= laravel.assets %>',
                    dest: '<%= laravel.dest %>/fonts',
                    src: [
                        'fonts/*.*'
                    ]
                }]
            }
        },
        // Run some tasks in parallel to speed up build process
        concurrent: {
            dist: [
                'imagemin'
            ]
        }
    });

    // Default task
    grunt.registerTask('default', [
        'jshint',
        'clean',
        'concurrent:dist',
        'concat',
        'uglify',
        'cssmin',
        //'copy:images',
        'copy:fonts',
        //'copy:bowerjs',
        'watch'
    ]);
};