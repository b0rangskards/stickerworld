!function($){"use strict";$(document).ready(function(){function processAjaxRequest(method,url,data){return $.ajax({method:method,url:url,data:data})}function processFormAjaxRequest(form){var method=form.find('input[name="_method"]').val()||"POST",url=form.prop("action");return processAjaxRequest(method,url,form.serialize())}function showSuccessDialog(title,message){swal({title:title,text:message,type:"success",timer:1500})}function showErrorDialog(title,message){swal({title:title,text:message,type:"error"})}function clearForm(form){form.find("div.form-group").removeClass("has-error"),form.find("p.help-block").html("")}function clearGroup(divGroup){divGroup.removeClass("has-error"),divGroup.find("p.help-block").html("")}function resetForm(form){clearForm(form),form[0].reset()}function displayError(fieldName,jsonObj){var current=$("input[name="+fieldName+"],  a[data-name="+fieldName+"]"),currentFormGroup=current.closest("div.form-group"),errorMessage=(current.closest("p.help-block"),"");$.isEmptyObject(jsonObj)||(currentFormGroup.addClass("has-error"),$.each(jsonObj,function(key,value){errorMessage+=value+"<br/>"}),current.parent().find("p.help-block").html(errorMessage).fadeIn(300))}function displayErrors(form,responseJSON){clearForm(form),$.each(responseJSON,function(key,value){displayError(key,value)})}function updateMapCenter(map,newLatLng){$(map).gmap3({map:{options:{center:[newLatLng.lat,newLatLng.lng]}}})}function stringifyErrors(jsonErrors){var errors="";return $.each(jsonErrors,function(key,value){errors+=value+"\n"}),errors}function loadUpdateDataFromModal(url,form,modal){var deferred=processAjaxRequest("GET",url,[]);deferred.done(function(data){var responseData=data.obj;$.each(responseData,function(key,value){form.find("input[name="+key+"]").val(value)})}).fail(function(){showErrorDialog("Error Encountered","Cannot display specified record."),modal.modal("hide")})}function processUpdateFormModal(form){var deferred=processFormAjaxRequest(form);deferred.done(function(data){showSuccessDialog(data.title,data.message),form.closest("div.modal").modal("hide"),location.reload()}).fail(function(jqXHR){var errors=jqXHR.responseJSON;console.log(errors),displayErrors(form,errors)})}$.fn.dcAccordion&&$("#nav-accordion").dcAccordion({eventType:"click",autoClose:!0,saveState:!0,disableLink:!0,speed:"slow",showCount:!1,autoExpand:!0,classExpand:"dcjq-current-parent"}),$.fn.slimScroll&&($(".event-list").slimscroll({height:"305px",wheelStep:20}),$(".conversation-list").slimscroll({height:"360px",wheelStep:35}),$(".to-do-list").slimscroll({height:"300px",wheelStep:35})),$.fn.niceScroll&&($(".leftside-navigation").niceScroll({cursorcolor:"#1FB5AD",cursorborder:"0px solid #fff",cursorborderradius:"0px",cursorwidth:"3px"}),$(".leftside-navigation").getNiceScroll().resize(),$("#sidebar").hasClass("hide-left-bar")&&$(".leftside-navigation").getNiceScroll().hide(),$(".leftside-navigation").getNiceScroll().show(),$(".right-stat-bar").niceScroll({cursorcolor:"#1FB5AD",cursorborder:"0px solid #fff",cursorborderradius:"0px",cursorwidth:"3px"})),$(".widget-head").click(function(e){var widgetElem=$(this).children(".widget-collapse").children("i");$(this).next(".widget-container").slideToggle("slow"),$(widgetElem).hasClass("ico-minus")?($(widgetElem).removeClass("ico-minus"),$(widgetElem).addClass("ico-plus")):($(widgetElem).removeClass("ico-plus"),$(widgetElem).addClass("ico-minus")),e.preventDefault()}),$(".leftside-navigation .sub-menu > a").click(function(){var o=$(this).offset(),diff=80-o.top;diff>0?$(".leftside-navigation").scrollTo("-="+Math.abs(diff),500):$(".leftside-navigation").scrollTo("+="+Math.abs(diff),500)}),$(".sidebar-toggle-box .fa-bars").click(function(e){$(".leftside-navigation").niceScroll({cursorcolor:"#1FB5AD",cursorborder:"0px solid #fff",cursorborderradius:"0px",cursorwidth:"3px"}),$("#sidebar").toggleClass("hide-left-bar"),$("#sidebar").hasClass("hide-left-bar")&&$(".leftside-navigation").getNiceScroll().hide(),$(".leftside-navigation").getNiceScroll().show(),$("#main-content").toggleClass("merge-left"),e.stopPropagation(),$("#container").hasClass("open-right-panel")&&$("#container").removeClass("open-right-panel"),$(".right-sidebar").hasClass("open-right-bar")&&$(".right-sidebar").removeClass("open-right-bar"),$(".header").hasClass("merge-header")&&$(".header").removeClass("merge-header")}),$(".toggle-right-box .fa-bars").click(function(e){$("#container").toggleClass("open-right-panel"),$(".right-sidebar").toggleClass("open-right-bar"),$(".header").toggleClass("merge-header"),e.stopPropagation()}),$(".header,#main-content,#sidebar").click(function(){$("#container").hasClass("open-right-panel")&&$("#container").removeClass("open-right-panel"),$(".right-sidebar").hasClass("open-right-bar")&&$(".right-sidebar").removeClass("open-right-bar"),$(".header").hasClass("merge-header")&&$(".header").removeClass("merge-header")}),$(".panel .tools .fa").click(function(){var el=$(this).parents(".panel").children(".panel-body");$(this).hasClass("fa-chevron-down")?($(this).removeClass("fa-chevron-down").addClass("fa-chevron-up"),el.slideUp(200)):($(this).removeClass("fa-chevron-up").addClass("fa-chevron-down"),el.slideDown(200))}),$(".panel .tools .fa-times").click(function(){$(this).parents(".panel").parent().remove()}),$(".tooltips").tooltip(),$(".popovers").popover(),$(".dynamic-table").dataTable({aaSorting:[[4,"desc"]]}),$("#flash-overlay-modal").modal(),$("form[data-remote-resendmail]").on("submit",function(e){var form=$(this),submitBtn=form.find('button[type="submit"]'),loader=form.parent("td").find("div.loader"),loaderLabel=form.parent().find(".loader-label");loader.show(),submitBtn.addClass("btn-disable"),submitBtn.find("i.fa").removeClass("fa-paper-plane-o").addClass("fa-spinner fa-spin");var deffered=processFormAjaxRequest(form);deffered.done(function(){loaderLabel.css("color","limegreen").html("Email sent!").fadeIn(300),setTimeout(function(){loaderLabel.fadeOut(300)},2500)}).fail(function(){loaderLabel.css("color","red").html("Failed").fadeIn(300),setTimeout(function(){loaderLabel.fadeOut(300)},2500)}).always(function(){submitBtn.find("i.fa").removeClass("fa-spinner fa-spin").addClass("fa-paper-plane-o"),loader.hide(),submitBtn.removeClass("btn-disable")}),e.preventDefault()}),$("form[data-remote-deactivate]").on("submit",function(e){e.preventDefault();var form=$(this),deffered=processFormAjaxRequest(form);deffered.done(function(){swal({title:"Deactivated!",text:"Account successfully deactivated.",type:"success",timer:1e3}),location.reload()})}),$("form[data-remote-reactivate]").on("submit",function(e){e.preventDefault();var form=$(this),deffered=($(this).closest("td"),processFormAjaxRequest(form));deffered.done(function(){swal({title:"Re-activated!",text:"Account successfully re-activated.",type:"success",timer:1e3}),location.reload()})}),$("input[data-confirm], button[data-confirm]").on("click",function(e){e.preventDefault();var input=$(this),form=input.closest("form"),prompt=input.data("confirm")||"Are you sure?",promptYes=input.data("confirm-yes")||"Yes, pls!";swal({title:"Are you sure?",text:prompt,type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:promptYes,cancelButtonText:"No, cancel pls!",closeOnConfirm:!1},function(isConfirm){isConfirm&&form.submit()})}),$.fn.editable.defaults.mode="inline",$.fn.editable.defaults.ajaxOptions={type:"PUT"},$("#username").editable({success:function(response,newValue){clearGroup($(this).closest("div.form-group")),showSuccessDialog("Username Changed!","Username Successfully Changed!"),$("ul.top-menu > li > a > span.username").html(newValue)},error:function(response){displayError("username",response.responseJSON.username)}}),$("#email").editable({success:function(){showSuccessDialog("Email Changed!","Email Successfully Changed!"),clearGroup($(this).closest("div.form-group"))},error:function(response){displayError("email",response.responseJSON.email)}}),$("#change-password-toggle").on("click",function(e){e.preventDefault();var changePasswordDiv=$("#change-password");changePasswordDiv.is(":visible")?changePasswordDiv.slideUp("slow"):changePasswordDiv.slideDown("slow")}),$("div#basic-details-div").mouseup(function(e){var containerDiv=$("#change-password");containerDiv.is(e.target)||0!==containerDiv.has(e.target).length||$("#change-password").slideUp("slow")}),$("#change-password-cancel-btn").on("click",function(e){e.preventDefault(),$("#change-password").slideUp("slow")}),$("form#change-password-form").on("submit",function(e){e.preventDefault();var form=$(this),deffered=processFormAjaxRequest(form);deffered.done(function(){clearForm(form),showSuccessDialog("Password Changed!","Password Successfully Changed!"),form.trigger("reset"),$("#change-password").slideUp("slow")}).fail(function(jqXHR){var errors=jqXHR.responseJSON;displayErrors(form,errors)})});var image=new google.maps.MarkerImage("http://plebeosaur.us/etc/map/bluedot_retina.png",null,null,new google.maps.Point(8,8),new google.maps.Size(17,17));$("#newBranchModal").on("shown.bs.modal",function(){$("#new-branch-map").gmap3({trigger:"resize",map:{options:{center:[GMAP.coords.lat,GMAP.coords.lng],zoom:GMAP.zoom,streetViewControl:!1}},marker:{latLng:[GMAP.coords.lat,GMAP.coords.lng],options:{draggable:!0,flat:!0,icon:image,optimized:!1,visible:!0,title:"I am here"},events:{dragend:function(marker){var newLatLng={lat:marker.position.A,lng:marker.position.F};updateMapCenter(this,newLatLng),$("#new-branch-lat-hidden").val(newLatLng.lat),$("#new-branch-lng-hidden").val(newLatLng.lng)}}}})}),$("#newBranchModal").on("show.bs.modal",function(){$("#new-branch-map").gmap3()}),$("#newBranchModal").on("hide.bs.modal",function(){$("#new-branch-map").gmap3("destroy")}),$(".modalSubmitBtnForm").on("click",function(){$(this).parent().parent().find("form").trigger("submit")}),$("div.modal-form form").on("submit",function(e){e.preventDefault();var form=$(this),deferred=processFormAjaxRequest(form),modal=$(this).parents("div.modal");deferred.done(function(data){showSuccessDialog(data.title,data.message),modal.modal("hide"),resetForm(form),location.reload()}).fail(function(jqXHR){var errors=jqXHR.responseJSON;displayErrors(form,errors)})}),$(".branches-panel-map-grid").each(function(index,element){var obj=$(element),lat=obj.data("lat"),lng=obj.data("lng");$(element).gmap3({map:{options:{center:[lat,lng],zoom:GMAP.minZoom,disableDefaultUI:!0}},marker:{latLng:[lat,lng],options:{flat:!0,icon:image,optimized:!1,visible:!0,title:"I am here"}}})}),$("form[data-remote-delete-record]").on("submit",function(e){e.preventDefault();var form=$(this),deferred=processFormAjaxRequest(form);deferred.done(function(data){showSuccessDialog(data.title,data.message),location.reload()}).fail(function(jqXHR){var errors=jqXHR.responseJSON;showErrorDialog("Error encountered",stringifyErrors(errors))})}),$("#updateBranchModal").on("hidden.bs.modal",function(){var form=$("#update-branch-form");resetForm(form),$("#update-branch-map").gmap3("destroy")}),$("#updateBranchModal").on("show.bs.modal",function(e){var triggerBtn=e.relatedTarget,id=$(triggerBtn).data("id"),url="/branch/fetchdata/"+id,form=$("#update-branch-form");$("#update-branch-map").gmap3(),loadUpdateDataFromModal(url,form,$(this))}),$("#updateBranchModal").on("shown.bs.modal",function(){var form=$("#update-branch-form"),lat=form.find("input[name=lat]").val(),lng=form.find("input[name=lng]").val();$("#update-branch-map").gmap3({trigger:"resize",map:{options:{center:[lat,lng],zoom:GMAP.minZoom,streetViewControl:!1}},marker:{latLng:[lat,lng],options:{draggable:!0,flat:!0,icon:image,optimized:!1,visible:!0,title:"I am here"},events:{dragend:function(marker){var newLatLng={lat:marker.position.A,lng:marker.position.F};updateMapCenter(this,newLatLng),$("#update-branch-lat-hidden").val(newLatLng.lat),$("#update-branch-lng-hidden").val(newLatLng.lng)}}}})}),$("form#update-branch-form").on("submit",function(e){e.preventDefault();var form=$(this);processUpdateFormModal(form)}),$("#updateDepartmentModal").on("show.bs.modal",function(e){var triggerBtn=e.relatedTarget,id=$(triggerBtn).data("id"),url="/department/fetchdata/"+id,form=$("#update-department-form");loadUpdateDataFromModal(url,form,$(this))}),$("form#update-department-form").on("submit",function(e){e.preventDefault();var form=$(this);processUpdateFormModal(form)})})}(jQuery);